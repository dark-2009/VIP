<!DOCTYPE html>
<html>
<head>
    <title>Approve Transaction</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .transaction { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { padding: 5px 10px; margin-right: 5px; }
    </style>
</head>
<body>
    <h1>Pending Transactions</h1>
    <div id="transactions"></div>

    <script>
        const GIST_ID = '49ac5568baf72fb3b31558d248ce7f57';
        const GITHUB_TOKEN = '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';

        async function loadTransactions() {
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                const gistData = await response.json();
                const transactions = JSON.parse(gistData.files['transactions.json'].content);
                
                let html = '';
                for (const [txnId, data] of Object.entries(transactions)) {
                    if (data.status === 'pending') {
                        html += `
                            <div class="transaction">
                                <h3>${txnId}</h3>
                                <p>UPI Ref: ${data.upiRef}</p>
                                <p>IP: ${data.ip}</p>
                                <p>Date: ${new Date(data.timestamp).toLocaleString()}</p>
                                <button onclick="updateStatus('${txnId}', 'approved')">Approve</button>
                                <button onclick="updateStatus('${txnId}', 'rejected')">Reject</button>
                            </div>
                        `;
                    }
                }
                
                document.getElementById('transactions').innerHTML = html || '<p>No pending transactions</p>';
                
            } catch (error) {
                console.error('Error loading transactions:', error);
                document.getElementById('transactions').innerHTML = '<p>Error loading transactions</p>';
            }
        }

        async function updateStatus(txnId, status) {
            try {
                // Get current gist
                const gistResponse = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                const gistData = await gistResponse.json();
                const transactions = JSON.parse(gistData.files['transactions.json'].content);
                
                // Update status
                transactions[txnId].status = status;
                transactions[txnId].processedAt = new Date().toISOString();
                
                // Save back to gist
                await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: {
                            'transactions.json': {
                                content: JSON.stringify(transactions, null, 2)
                            }
                        }
                    })
                });
                
                alert(`Transaction ${txnId} ${status}`);
                loadTransactions();
                
            } catch (error) {
                console.error('Error updating status:', error);
                alert('Failed to update status');
            }
        }

        // Load transactions on page load
        window.onload = loadTransactions;
    </script>
</body>
</html>
